# EC2 - Elastic Compute Cloud

## EC2 101
A web service that provides resizable compute capacity in the cloud.

Reduces time required to boot new server instances to minutes, allowing you to quickly scale capacity, both up and down, as your computing requirements change.

### EC2 Pricing Models
1. On Demand
    * Allows you to pay a fixed rate by the hour (or by the second) with no commitment.
2. Reserved
    * Provides you with a capacity reservation, and offer a significant discount on hourly charges for an instance.
    * Contract Terms are 1 Year or 3 Years Terms.
3. Spot
    * Enables you to bid whatever price you want for instance capcacity, providing for even greater savings if your applications have flexible start and end times.
4. Dedicated Hosts
    * Physical EC2 server dedicated for your use.
    * Dedicated Hosts can help you reduce costs by allowing you to use your existing server-bound software liscenses.

### On Demand Pricing
For users that want the low cost and flexibility of Amazon EC2 without any up-front payment or long-term commitment

Good for applications with short term, spiky, or unpredictable workloads that can not be interrupted.

Also good for applications being developed or tested on Amazon EC2 for the first time.

### Reserved Pricing
Good for applicatins with steady state or predictable usage.

Applications that require reserved capacity

Users are able to make upfront payments to reduce their total computing costs even further

Comes in three types:
1. Standard Reserved Instances
    * Offer up to 75% off on demand instances. They longer the term and more up front, the greater the discount.
2. Convertible Reserved Instances:
    * Off up to 54% off on demand with capability to convert to a different instance type of equal or greater value.
3. Scheduled Reserved Instances
    * These are available to launch within the time windows you reserve, allowing you to match your capacity reservation to a predictable recurring schedule

### Spot Pricing
Useful for applications with flexible start and end times.

Only good for applications that are only feasible at very low compute prices

Also good for users with urgent computing needs for large amounts of additional capacity.

### Dedicated Hosting Pricing
Useful for regulatory requirements that may not support multi-tenant virtualization.

Great for liscensing which does not support multi-tenancy or cloud deployments.

Can be purchased On-Demand (hourly), or as a Reservatrion for up to 70% off the On-Demand price.

### EC2 - Exam Tips
A web service that provides resizable compute capacity in the cloud.

Reduces time required to boot new server instances to minutes, allowing you to quickly scale capacity, both up and down, as your computing requirements change.

Know the EC2 Pricing Options

Also - if the Spot instance is terminated by Amazon EC2, you will not be charged for a partial hour of usage. Howerver, if you terminate the instance yourself, you will be charged for any hour in which the instance ran.

## EC2 Instance Launch Lab - Exam Tips
Termination protection is **turned off* by default, you must turn it on yourself.

On an EBS-backed instance, the **default action is for the root EBS volume to be deleted** when the instance is terminated.
    * Any additional volumes, ny defualt, won't be.

EBS Root Volumes of your DEFAULT AMI's **CAN** now be encrypted. You can also use a third party tool to encrypt the root volume or this can be done when creating AMI's in the AWS console or using the API.
* Additional volumes can also be encrypted.

## Security Groups Lab - Exam Tips
All inbound traffic is blocked by default and sll outbound traffic is allowed.
* This is because Security Groups are STATEFUL.

Changes to Security Groups take effect immediately.

You can have any number of EC2 instances within a security group,
and you can have multiple security groups attached to an EC2 instances.

You cannot block specific IP addresses using Security Groups, instead use Network Access Control Lists.

You can specify allow rules, but not deny rules.

--- 
## EBS 101
What is EBS?

Elastic Block Store - it is a virtual hard disk in the cloud. 

Comes in 5 general flavors:
* General Purpose (SSD)
    * Use cases - most work loads
    * API name is gp2 - suitable for workloads up to 16,000 IOPS/volume
* Provisioned IOPS (SSD) - highest performnce SSD volume designed for mission-critical appliations
    * Use cases - Databases
    * API name is io1 - capable o fup to 64,000 IOPS 
* Throughput Optimized Hard Disk Drive
    * st1
    * 500 IOPS
    * Used for big data in data warehousing
* Cold Hard Disk Drive - lowest cost for HDD
    * sc1
    * Less frequently accessed workloads such as File servers
    * 250 IOPS
* Magnetic
    * Previous generation HDD
    * 40-200 IOPS

## EBS Volumes & Snapshots Lab - Exam Tips
Volumes exist on EBS, which you can think of as a virtual hard drive.

Snapshots exist on S3. Think of snapshots as a photograph of the disk.
* Snapshots are point in time copies of volumes.
* Snapshots are incremental, this means that only the blocks that have changed since your last snapshot are moved to S3.
* If it is your first snapshot it may take some time to create.

It is best practice that when taking a snapshot of a volume that serves as the root device, you should stop the instance before taking the snapshot.
* However you can take a snapshot while an instance is running.

You can create AMI's from Snapshots

You can change EBS volume sizes on the fly, including changing the size and storage type.

Volumes will ALWAYS be in the same availability zone as the EC2 instance.

To move an EC2 volume from one AZ to another, take a snapshot of it, create an AMI from the snapshot and then use the AMI to launch the EC2 instance in a new AZ.

Likewise, to move an EC3 volume from one region to another, take a snapshot of it, create an AMI from the snapshot and then copy the AMI from one region to another. Then use the copied AMI to launch the new EC2 instance in the new region.

## AMI Types - EBS vs Instance Store
You can select your AMI ( Amazon Machine Image) based on:
* Region
* Operating System
* Architecture (32-bit or 64-bit)
* Launch Permissions
* Storage for the Root Device (aka the Root Device Volume). Two options here:
    * Instance Store (EPHEMERAL STORAGE)
    * EBS Backed Volumes

All AMIs are categorized as either backed by Amazon EBS or backed by instance store

**For EBS Volumes**: The root device for an instance launched from the AMI is an Amazon EBS volume created from an Amazon EBS snapshot.

**For Instance Store Volumes**: The root device for an instance launched from the AMI  is an instance store volume created from a template stored in Amazon S3.

## AMI Types - Exam Tips
Instance Store Volumes are sometimes called Ephemeral Storage. These can not be stopped and if the underlying host fails, you will lose your data.

EBS backed instances they can be stopped and you will not lose the data if it is stopped.

With both you can reboot and not lose data.

By default, both root volumes will be deleted on termination. However, with EBS volumes, you can tell AWS to keep the root device volume. (Cant do that with instance store)

---

## ENI vs ENA vs EFA
**ENI - Elastic Network Interface** - essentially a virtual network card

**EN - Enhanced Networking** - Uses single root I/O virtualization (SR-IOV) to provide high-performance networking capabilities on supported instance types.

**EFA - Elastic Fabric Adapter** - A network device that you can attach to your Amazon EC2 instance to accelerate High Performance Computing (HPC) and machine learning applications.

### Elastic Network Interface (ENI)
Simply a virtual network card for your EC2 instances. It allows:
* A primary private IPv4 address from the IPv4 address range of your VPC
* One or more secondary private IPv4 addresses form the IPv4 address range of your VPC
* One Elastic IP address (IPv4) per private IPv4 address
* One public IPv4 address
* One of more IPv6 addresses
* One or more security groups
* A MAC address
* A source/destination check flag
* A description

When you provision and EC2 instance it will have an ENI provisioned to it automatically, and then you can add additional ones.

Scenarios for Network Interfaces:
 * Create a management network
* Use network and security appliances in your VPC
* Create dual-homed isntances with worloads/roles on distinct subnets
* Create a low-budget, high-availability solution

### Enhanced Networking (EN)
Uses a single root I/O virtualization to provide high-performance networking capabilities on supported instance types.
* Single Root I/O Virtualization (SR-IOV) is a method of device virtualization that provides higher I/O performances and lower CPU utilization when compated to traditional virtualized network interfaces.

Enhanced networking provides higher bandwidth, higher packet per second (PPS) performance, and consistently lower inter-instance latencies. 

There is no additional charge for using enhanced networking, so use when you want good network performance. (restricted however by EC2 instance type)

Depending on your instance type, enhanced networking can be enabled using:
* **Elastic Network Adapter (ENA)**, which supports network speeds of up to 100 Gbps for supported instance types.

OR 

* Intel 82500 **Virtual Function (VF)** interface, which supports network speeds of up to 10 Gbps for supported instance types, This is typically used on older instances.

note: if asked on exam which is better given some scenario, choose ENA.

### Elastic Fabric Adapter (EFA)
A network device that you can attach to your Amazon EC2 instance to accelerate High Performance Computing (HPC) and machine learning applications.

EFA provides lower and more consistent latency and higher throughput than the TCP transport traditionally used in cloud-based HPC systems.

EFA can use OS-bypass, which enables HPC to and machine learning applications to bypass the OS kernel and communicate directly with the EFA device. This makes it a lot faster with much lower latency. Not currently supported on Windows, currently only Linux.

### ENI ENA EFA - Exam Tips
In the exam you will be given different scenarios and you will be asked to choose whether you should use an ENI, EN, or EFA.

#### ENI
For basic networking. Perhaps you need a seperate management network to your production network or a seperate logging network and you need to do this at low cost. In this scenario use multiple ENIs for each network.

#### Enhanced Networking
For when you need speeds between 10Gbps and 100Gbps. Anywhere you need reliable, high throughput.

#### Elastic Fiber Adaptor
For when you need to accelerate High Performance Computing (HPC) and machine learning applications OR if you need to do an OS bypass. If you see a scenario question mentioning HPC or ML and asking what network adaptor you want, choose EFA.

---

## Encrypted Root Device Volumes & Snapshots - Lab
Root Device Volume is the EBS that has the OS on it.

Root Device volumes can now be encrypted upon creation, as well as after creation.

How to encrypt an unencrypted root device volume:
1. Take snapshot of EBS volume
2. Make encrypted copy of snapshot
3. Create AMI from encrypted copy
4. Use AMI to launch an EC2 with an encrypted root device volume

### Exam Tips
Snapshots of encrypted volumes are encrypted automatically.

Volumes restored from encrypted snapshots are encrypted automatically.

You can share snapshots, but only if they are unencrypted.
* These snapshots can be shared with other AWS accounts or made public.

You can now encrypt root device volumes upon creation of the EC2 instance.

How to encrypt an unencrypted root device volume:
1. Take snapshot of EBS volume
2. Make encrypted copy of snapshot
3. Create AMI from encrypted copy
4. Use AMI to launch an EC2 with an encrypted root device volume

---

## CloudWatch 101
What is CloudWatch?

It is a monitoring service to monitor your AWS resources, as well as the applications that you run on AWS

Monitors things like:
* Compute
    * EC2 Instances
    * Autoscaling Groups
    * Elastic Load Balancers
    * Route 53 Health Checks
* Storage and Content Delivery
    * EBS Volumes
    * Storage Gateways
    * CloudFront

CloudWatch with EC2 monitors at a host level:
* CPU
* Network
* Disk
* Status Checks

May be given an example where aske dif you should use CloudWatch or CloudTrail

AWS CloudTrail increases visibility into your user and resource activity by recording AWS Management Console actions and API calls. You can identify which users and accounts called AWS, the source IP address from which the calls were made, and when the calls occurred.

Think of CloudWatch as a watcher of performance.<br>
Think of CloudTrail as a security camera.

### CloudWatch - Exam Tips
CloudWatch is used for monitoring performance.

CloudWatch can monitor most of AWS as well as your applications that run on AWS.

CloudWatch with EC2 will monitor events every 5 minutes by default.
* You can have 1 minute intervals by turning on detailed monitoring.

You can create CloudWatch alarms, which trigger notifications
* We did this when we created the Billing Alarm in the previous section.

CloudWatch is all about performance, where CloudTrail is all about auditing.

## CloudWatch Lab - Exam Tips

Standard Monitoring is 5 minutes.

Detailed Monitoring is 1 minute.

Remember what you can do with CloudWatch:
* Dashboards - Can create awesome dashboards to see what is happening with your AWS environment
* Alarms - Allows you to set Alarms that notify you when particular thresholds are  hit
* Events - CloudWatch Events help you to respond to state changes in your AWS resources
* Logs - CloudWatch Logs allow you to aggregate, monitor and store your log data

CloudWatch monitors performance.<br>
CLoudTrail monitors API calls in the AWS Platform.

---

## AWS Command Line (CLI) Lab - Exam Tips
You can interact with AWS from anywhere in the world just by using the command line (CLI).
* You will need to set up access in IAM

Commands themselves are not in the exam, however some basic commands are useful to know for real life.

## IAM Roles to Access the Command Line Lab - Roles
Roles are more secure than storing your access key and secret access key on individual EC2 instances.

Roles are easier to manage.
* If you have some configuration applied to 100 servers, it will take forever to update each server's .aws/config file.
* If each server had a Role defined instead, updating this Role would be much quicker.

Roles can be assigned to an EC2 instance after it si crated using both the console & the command line.

Roles are universal, they can be used in any region.

## Boot Strap Scripts
By startin with `#!/bin/bash` , you can list a commands for your bash terminal to run once it begins running. The option to do this is in the Advanced Details section the Configure Instance page for EC2.


## Instance Metadata Lab - Exam Tips
Instance metadata is used to get information about an instance.
    * Such as public IP address

Command used for this is `curl http://169.254.169.254/latest/meta-data/` .

Can also get user data with `curl http://169.254.169.254/latest/user-data/` to return the boot strap script passed to the server when it is first commisioned.

## EFA - Elastic File System
